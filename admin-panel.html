<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - UmrahFlex CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #047857;
            --secondary: #d97706;
            --accent: #0891b2;
            --gold: #f59e0b;
        }
        
        body { 
            font-family: 'Poppins', sans-serif;
        }
        
        .display-font {
            font-family: 'Playfair Display', serif;
        }
        
        .stat-card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        
        .stat-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.12); 
        }
        
        .nav-link { 
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-link:hover { 
            background: rgba(4, 120, 87, 0.05); 
            border-left-color: #047857;
        }
        
        .nav-link.active { 
            background: rgba(4, 120, 87, 0.1); 
            border-left-color: #047857;
            font-weight: 600;
        }
        
        .mobile-sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-sidebar.active {
            transform: translateX(0);
        }
        
        html { scroll-behavior: smooth; }
        :focus-visible { outline: 3px solid var(--gold); outline-offset: 3px; }
        body.no-scroll { overflow: hidden; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-content {
            animation: fadeIn 0.4s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Top Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 sm:h-20">
                <div class="flex items-center space-x-3 sm:space-x-4">
                    <button class="md:hidden w-10 h-10 rounded-lg hover:bg-gray-100 flex items-center justify-center transition-colors"
                            aria-label="Open navigation" onclick="openMobileSidebar()">
                        <i class="fas fa-bars text-gray-700"></i>
                    </button>
                    <a href="index.html" class="flex items-center space-x-3 group">
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-emerald-500 to-cyan-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-kaaba text-white text-lg sm:text-xl"></i>
                        </div>
                        <div>
                            <span class="text-lg sm:text-xl font-bold display-font bg-gradient-to-r from-emerald-700 to-cyan-600 bg-clip-text text-transparent">UmrahFlex</span>
                            <p class="text-xs text-gray-500 hidden sm:block">Admin Panel</p>
                        </div>
                    </a>
                </div>

                <div class="hidden md:flex items-center space-x-4">
                    <button onclick="refreshDashboard()" class="text-gray-600 hover:text-emerald-600 transition px-3 py-2 rounded-lg hover:bg-emerald-50">
                        <i class="fas fa-sync-alt mr-1"></i> Refresh
                    </button>
                    <a href="packages.html" class="text-gray-600 hover:text-emerald-600 transition px-3 py-2 rounded-lg hover:bg-emerald-50">
                        <i class="fas fa-box-open mr-1"></i> Packages
                    </a>
                    <a href="inbox.html" class="text-gray-600 hover:text-emerald-600 transition px-3 py-2 rounded-lg hover:bg-emerald-50">
                        <i class="fas fa-inbox mr-1"></i> Inbox
                    </a>
                    <a href="index.html" class="text-gray-600 hover:text-emerald-600 transition px-3 py-2 rounded-lg hover:bg-emerald-50">
                        <i class="fas fa-home mr-1"></i> Home
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex min-h-screen bg-gray-50">
        <!-- Sidebar (Desktop) -->
        <aside class="hidden md:block w-64 bg-white shadow-lg">
            <div class="p-6 border-b">
                <p class="text-sm text-gray-500 font-semibold uppercase tracking-wide">Navigation</p>
            </div>
            <nav class="p-3">
                <a href="#" onclick="showSection('dashboard', event); return false;" class="nav-link active flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-chart-line w-5 mr-3 text-emerald-600"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" onclick="showSection('offices', event); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-building w-5 mr-3 text-cyan-600"></i>
                    <span>Office Management</span>
                </a>
                <a href="#" onclick="showSection('teams', event); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-users w-5 mr-3 text-amber-600"></i>
                    <span>Team Management</span>
                </a>
                <a href="#" onclick="showSection('leads', event); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-user-circle w-5 mr-3 text-purple-600"></i>
                    <span>Lead Tracking</span>
                </a>
                <a href="#" onclick="showSection('reports', event); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-file-alt w-5 mr-3 text-orange-600"></i>
                    <span>Reports</span>
                </a>
            </nav>
        </aside>

        <!-- Mobile Sidebar -->
        <div id="mobileSidebar" class="mobile-sidebar fixed inset-y-0 left-0 w-72 max-w-[85vw] bg-white shadow-2xl z-[60] md:hidden">
            <div class="p-4 border-b flex items-center justify-between">
                <p class="text-sm text-gray-600 font-semibold">Navigation</p>
                <button class="w-10 h-10 rounded-lg hover:bg-gray-100" aria-label="Close navigation" onclick="closeMobileSidebar()">
                    <i class="fas fa-times text-gray-700"></i>
                </button>
            </div>
            <nav class="p-3">
                <a href="#" onclick="showSection('dashboard', event); closeMobileSidebar(); return false;" class="nav-link active flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-chart-line w-5 mr-3"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" onclick="showSection('offices', event); closeMobileSidebar(); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-building w-5 mr-3"></i>
                    <span>Office Management</span>
                </a>
                <a href="#" onclick="showSection('teams', event); closeMobileSidebar(); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-users w-5 mr-3"></i>
                    <span>Team Management</span>
                </a>
                <a href="#" onclick="showSection('leads', event); closeMobileSidebar(); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-user-circle w-5 mr-3"></i>
                    <span>Lead Tracking</span>
                </a>
                <a href="#" onclick="showSection('reports', event); closeMobileSidebar(); return false;" class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg mb-2">
                    <i class="fas fa-file-alt w-5 mr-3"></i>
                    <span>Reports</span>
                </a>
            </nav>
        </div>

        <!-- Mobile Sidebar Overlay -->
        <div id="sidebarOverlay" class="hidden fixed inset-0 bg-black/50 z-50 md:hidden" onclick="closeMobileSidebar()"></div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
                
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="section-content">
                    <div class="mb-8">
                        <h1 class="text-3xl sm:text-4xl font-bold display-font text-gray-900 mb-2">üìä Dashboard Overview</h1>
                        <p class="text-gray-600">Real-time business intelligence and analytics</p>
                    </div>

                    <!-- Main Statistics Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
                        <!-- Total Packages -->
                        <div class="stat-card bg-gradient-to-br from-cyan-500 to-cyan-700 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-cyan-100 text-sm font-medium uppercase tracking-wide">Total Packages</p>
                                    <p id="statTotalPackages" class="text-4xl font-bold mt-2">0</p>
                                    <p class="text-cyan-100 text-sm mt-2">
                                        <span id="statActivePackages" class="font-semibold">0</span> Active
                                    </p>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-2xl p-4">
                                    <i class="fas fa-box-open text-4xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Total Leads -->
                        <div class="stat-card bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-emerald-100 text-sm font-medium uppercase tracking-wide">Total Leads</p>
                                    <p id="statTotalLeads" class="text-4xl font-bold mt-2">0</p>
                                    <p class="text-emerald-100 text-sm mt-2">
                                        <span id="statNewLeads" class="font-semibold">0</span> New
                                    </p>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-2xl p-4">
                                    <i class="fas fa-users text-4xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Total Offices -->
                        <div class="stat-card bg-gradient-to-br from-amber-500 to-amber-700 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-amber-100 text-sm font-medium uppercase tracking-wide">Total Offices</p>
                                    <p id="statTotalOffices" class="text-4xl font-bold mt-2">0</p>
                                    <p class="text-amber-100 text-sm mt-2">
                                        <span id="statActiveOffices" class="font-semibold">0</span> Active
                                    </p>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-2xl p-4">
                                    <i class="fas fa-building text-4xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Deal Done -->
                        <div class="stat-card bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm font-medium uppercase tracking-wide">Deal Done</p>
                                    <p id="statDealDone" class="text-4xl font-bold mt-2">0</p>
                                    <p class="text-purple-100 text-sm mt-2">
                                        <span id="statConversionRate" class="font-semibold">0%</span> Rate
                                    </p>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-2xl p-4">
                                    <i class="fas fa-trophy text-4xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Lead Status Distribution</h3>
                            <canvas id="leadStatusChart" class="w-full" style="max-height: 300px;"></canvas>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Airport Performance</h3>
                            <canvas id="airportChart" class="w-full" style="max-height: 300px;"></canvas>
                        </div>
                    </div>

                    <!-- Recent Activities -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Recent Activities</h3>
                        <div id="recentActivities" class="space-y-3">
                            <p class="text-gray-500 text-center py-4">Loading activities...</p>
                        </div>
                    </div>
                </div>

                <!-- Office Management Section -->
                <div id="offices-section" class="section-content hidden">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                        <div>
                            <h1 class="text-3xl sm:text-4xl font-bold display-font text-gray-900 mb-2">üè¢ Office Management</h1>
                            <p class="text-gray-600">Manage all offices and locations</p>
                        </div>
                        <button onclick="showOfficeModal()" class="w-full sm:w-auto bg-gradient-to-r from-emerald-500 to-cyan-600 hover:shadow-lg text-white px-6 py-3 rounded-xl font-semibold transition flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i>Add Office
                        </button>
                    </div>
                    <div id="officesContainer" class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-gray-500 text-center py-8">Loading offices...</p>
                    </div>
                </div>

                <!-- Team Management Section -->
                <div id="teams-section" class="section-content hidden">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                        <div>
                            <h1 class="text-3xl sm:text-4xl font-bold display-font text-gray-900 mb-2">üë• Team Management</h1>
                            <p class="text-gray-600">Manage team members and assignments</p>
                        </div>
                        <button onclick="showTeamModal()" class="w-full sm:w-auto bg-gradient-to-r from-emerald-500 to-cyan-600 hover:shadow-lg text-white px-6 py-3 rounded-xl font-semibold transition flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i>Add Team Member
                        </button>
                    </div>
                    <div id="teamsContainer" class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-gray-500 text-center py-8">Loading team members...</p>
                    </div>
                </div>

                <!-- Leads Section -->
                <div id="leads-section" class="section-content hidden">
                    <div class="mb-6">
                        <h1 class="text-3xl sm:text-4xl font-bold display-font text-gray-900 mb-2">üìã Lead Tracking</h1>
                        <p class="text-gray-600">Monitor and manage all customer leads</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <select id="filterStatus" onchange="filterLeads()" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="">All Status</option>
                                <option value="new">New</option>
                                <option value="contacted">Contacted</option>
                                <option value="deal_done">Deal Done</option>
                            </select>
                            <select id="filterAirport" onchange="filterLeads()" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="">All Airports</option>
                                <option value="Lahore">Lahore</option>
                                <option value="Karachi">Karachi</option>
                                <option value="Islamabad">Islamabad</option>
                            </select>
                            <button onclick="resetFilters()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition">
                                <i class="fas fa-redo mr-2"></i>Reset
                            </button>
                        </div>
                    </div>
                    <div id="leadsContainer" class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <p class="text-gray-500 text-center py-8">Loading leads...</p>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports-section" class="section-content hidden">
                    <div class="mb-6">
                        <h1 class="text-3xl sm:text-4xl font-bold display-font text-gray-900 mb-2">üìà Reports</h1>
                        <p class="text-gray-600">Comprehensive business analytics</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Airport Performance</h3>
                            <div id="airportReport" class="space-y-3">
                                <p class="text-gray-500 text-center py-4">Loading report...</p>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Team Performance</h3>
                            <div id="teamReport" class="space-y-3">
                                <p class="text-gray-500 text-center py-4">Loading report...</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://umrah-crm-server.replit.app/api';
        
        let dashboardData = {
            packages: [],
            leads: [],
            offices: [],
            teams: []
        };

        // Navigation
        function showSection(sectionName, event) {
            if (event) event.preventDefault();
            
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            event?.target.closest('.nav-link')?.classList.add('active');
            
            if (sectionName === 'offices') loadOffices();
            if (sectionName === 'teams') loadTeams();
            if (sectionName === 'leads') loadLeadsTable();
            if (sectionName === 'reports') loadReports();
        }

        // Mobile Sidebar
        function openMobileSidebar() {
            document.getElementById('mobileSidebar').classList.add('active');
            document.getElementById('sidebarOverlay').classList.remove('hidden');
            document.body.classList.add('no-scroll');
        }

        function closeMobileSidebar() {
            document.getElementById('mobileSidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.add('hidden');
            document.body.classList.remove('no-scroll');
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                const [pkgs, leads, offices, teams] = await Promise.all([
                    fetch(`${API_URL}/packages`).then(r => r.json()).catch(() => []),
                    fetch(`${API_URL}/leads`).then(r => r.json()).catch(() => []),
                    fetch(`${API_URL}/offices`).then(r => r.json()).catch(() => []),
                    fetch(`${API_URL}/team-members`).then(r => r.json()).catch(() => [])
                ]);

                dashboardData = { packages: pkgs, leads, offices, teams };
                
                // Update stats
                document.getElementById('statTotalPackages').textContent = pkgs.length;
                document.getElementById('statActivePackages').textContent = pkgs.filter(p => p.status === 'Active').length;
                document.getElementById('statTotalLeads').textContent = leads.length;
                document.getElementById('statNewLeads').textContent = leads.filter(l => l.status === 'new').length;
                document.getElementById('statTotalOffices').textContent = offices.length;
                document.getElementById('statActiveOffices').textContent = offices.filter(o => o.status === 'active').length;
                
                const dealDone = leads.filter(l => l.status === 'deal_done').length;
                document.getElementById('statDealDone').textContent = dealDone;
                document.getElementById('statConversionRate').textContent = leads.length > 0 ? ((dealDone / leads.length) * 100).toFixed(1) + '%' : '0%';

                // Load charts
                loadLeadStatusChart();
                loadAirportChart();
                loadRecentActivities();

            } catch (err) {
                console.error('Error loading dashboard:', err);
            }
        }

        function loadLeadStatusChart() {
            const ctx = document.getElementById('leadStatusChart');
            if (!ctx) return;

            const statusCount = {};
            dashboardData.leads.forEach(lead => {
                statusCount[lead.status] = (statusCount[lead.status] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCount),
                    datasets: [{
                        data: Object.values(statusCount),
                        backgroundColor: ['#06b6d4', '#10b981', '#f59e0b', '#8b5cf6', '#ef4444', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function loadAirportChart() {
            const ctx = document.getElementById('airportChart');
            if (!ctx) return;

            const airportCount = {};
            dashboardData.leads.forEach(lead => {
                const airport = lead.departure_airport || 'Unknown';
                airportCount[airport] = (airportCount[airport] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(airportCount),
                    datasets: [{
                        label: 'Leads',
                        data: Object.values(airportCount),
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function loadRecentActivities() {
            const container = document.getElementById('recentActivities');
            const recent = dashboardData.leads.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No recent activities</p>';
                return;
            }

            container.innerHTML = recent.map(lead => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                    <div>
                        <p class="font-semibold text-gray-900">${lead.name || 'Unknown'}</p>
                        <p class="text-sm text-gray-600">${lead.phone || 'No phone'} ‚Ä¢ ${lead.status || 'unknown'}</p>
                    </div>
                    <span class="text-xs text-gray-500">${new Date(lead.created_at).toLocaleDateString()}</span>
                </div>
            `).join('');
        }

        async function loadOffices() {
            const container = document.getElementById('officesContainer');
            const offices = dashboardData.offices;

            if (offices.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No offices found. Add your first office.</p>';
                return;
            }

            container.innerHTML = `
                <div class="grid gap-4">
                    ${offices.map(office => `
                        <div class="border border-gray-200 rounded-xl p-6 hover:shadow-md transition">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-gray-900">${office.name}</h3>
                                    <p class="text-gray-600 text-sm mt-1">${office.city || 'Unknown'}, ${office.country || 'Unknown'}</p>
                                    <div class="mt-3 flex flex-wrap gap-2">
                                        <span class="px-3 py-1 bg-emerald-100 text-emerald-700 text-xs font-semibold rounded-full">
                                            ${office.status || 'active'}
                                        </span>
                                        <span class="text-sm text-gray-600">
                                            <i class="fas fa-users mr-1"></i>${office.team_members_count || 0} members
                                        </span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editOffice(${office.id})" class="text-blue-600 hover:text-blue-700 p-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteOffice(${office.id})" class="text-red-600 hover:text-red-700 p-2">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function loadTeams() {
            const container = document.getElementById('teamsContainer');
            const teams = dashboardData.teams;

            if (teams.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No team members found. Add your first member.</p>';
                return;
            }

            container.innerHTML = `
                <div class="grid gap-4">
                    ${teams.map(member => `
                        <div class="border border-gray-200 rounded-xl p-6 hover:shadow-md transition">
                            <div class="flex justify-between items-start">
                                <div class="flex items-center space-x-4 flex-1">
                                    <div class="w-12 h-12 bg-gradient-to-br from-emerald-400 to-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-xl">
                                        ${member.name.charAt(0).toUpperCase()}
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">${member.name}</h3>
                                        <p class="text-gray-600 text-sm">${member.email || 'No email'}</p>
                                        <div class="mt-2 flex flex-wrap gap-2">
                                            <span class="px-3 py-1 bg-cyan-100 text-cyan-700 text-xs font-semibold rounded-full">
                                                ${member.role || 'member'}
                                            </span>
                                            <span class="text-sm text-gray-600">
                                                <i class="fas fa-tasks mr-1"></i>${member.assigned_leads_count || 0} leads
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editTeamMember(${member.id})" class="text-blue-600 hover:text-blue-700 p-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteTeamMember(${member.id})" class="text-red-600 hover:text-red-700 p-2">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function loadLeadsTable() {
            const container = document.getElementById('leadsContainer');
            const leads = dashboardData.leads;

            if (leads.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No leads found</p>';
                return;
            }

            container.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Airport</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${leads.slice(0, 20).map(lead => `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="font-medium text-gray-900">${lead.name || 'Unknown'}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        ${lead.phone || 'No phone'}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-emerald-100 text-emerald-800">
                                            ${lead.status || 'unknown'}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        ${lead.departure_airport || 'N/A'}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        ${new Date(lead.created_at).toLocaleDateString()}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        async function loadReports() {
            const { leads } = dashboardData;

            // Airport Report
            const airportStats = {};
            leads.forEach(lead => {
                const airport = lead.departure_airport || 'Unknown';
                if (!airportStats[airport]) airportStats[airport] = { total: 0, deal_done: 0 };
                airportStats[airport].total++;
                if (lead.status === 'deal_done') airportStats[airport].deal_done++;
            });

            document.getElementById('airportReport').innerHTML = Object.entries(airportStats).map(([airport, stats]) => {
                const rate = stats.total > 0 ? ((stats.deal_done / stats.total) * 100).toFixed(1) : '0.0';
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-gray-900">${airport}</p>
                                <p class="text-sm text-gray-600">${stats.total} leads</p>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-emerald-600">${stats.deal_done}</p>
                                <p class="text-sm text-gray-500">${rate}% conversion</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Team Report (simplified)
            document.getElementById('teamReport').innerHTML = '<p class="text-gray-500 text-center py-4">Team performance report coming soon</p>';
        }

        // Utility functions
        function refreshDashboard() {
            loadDashboardData();
        }

        function filterLeads() {
            loadLeadsTable();
        }

        function resetFilters() {
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterAirport').value = '';
            loadLeadsTable();
        }

        function showOfficeModal() {
            alert('Office modal will be implemented');
        }

        function showTeamModal() {
            alert('Team modal will be implemented');
        }

        function editOffice(id) {
            alert(`Edit office ${id}`);
        }

        function deleteOffice(id) {
            if (confirm('Delete this office?')) {
                console.log('Delete office', id);
            }
        }

        function editTeamMember(id) {
            alert(`Edit team member ${id}`);
        }

        function deleteTeamMember(id) {
            if (confirm('Delete this team member?')) {
                console.log('Delete member', id);
            }
        }

        // Initialize
        loadDashboardData();
    </script>
</body>
</html>
