<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Inbox - Umrah System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            direction: rtl;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // ‚öôÔ∏è CONFIGURATION
        const API_URL = 'https://api.umrahflex.com';
        
        // Simple Icons
        const Icons = {
            MessageCircle: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>,
            Phone: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>,
            Calendar: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            Users: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            UserCheck: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            AlertCircle: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
        };

        function UmrahInbox() {
            const [conversation, setConversation] = useState(null);
            const [loading, setLoading] = useState(true);
            const [updating, setUpdating] = useState(false);
            const [error, setError] = useState(null);

            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('t');
            const conversationId = window.location.pathname.split('/').pop();

            useEffect(() => {
                loadConversation();
            }, []);

            const loadConversation = async () => {
                try {
                    setLoading(true);
                    
                    // Mock data - Replace with actual API call
                    // const response = await fetch(`${API_URL}/api/inbox/${conversationId}?token=${token}`);
                    // const data = await response.json();
                    
                    // Demo data
                    const mockData = {
                        lead_id: 123,
                        wa_number: '+92-300-1234567',
                        status: 'assigned',
                        team_name: 'Team Alpha',
                        created_at: '2026-01-12T10:30:00Z',
                        answers: {
                            departure_airport: 'Karachi',
                            hotel_distance_makkah_m: '100-300m',
                            budget_range: '150,000-200,000',
                            people_count: '3-4',
                            people_breakdown: '2 ÿ®ÿßŸÑÿ∫ÿå 2 ÿ®⁄Ü€í',
                            travel_date: 'ŸÖÿßÿ±⁄Ü 2026',
                            islamic_month: 'Ramadan',
                            duration_days: '14 ÿØŸÜ'
                        },
                        messages: [
                            { sender: 'bot', text: 'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑ€å⁄©ŸÖ! ÿ¢Ÿæ ⁄©ÿ≥ ÿß€åÿ¶ÿ±ŸæŸàÿ±Ÿπ ÿ≥€í ÿ≥ŸÅÿ± ⁄©ÿ±€å⁄∫ ⁄Ø€íÿü', time: '10:30' },
                            { sender: 'customer', text: 'Karachi', time: '10:31' },
                            { sender: 'bot', text: 'ÿ≠ÿ±ŸÖ ŸÖ⁄©€Å ÿ≥€í €ÅŸàŸπŸÑ ⁄©ÿß ⁄©ÿ™ŸÜÿß ŸÅÿßÿµŸÑ€Å Ÿæÿ≥ŸÜÿØ ⁄©ÿ±€å⁄∫ ⁄Ø€íÿü', time: '10:31' },
                            { sender: 'customer', text: '100-300m', time: '10:32' },
                            { sender: 'bot', text: 'ŸÅ€å ÿ¥ÿÆÿµ ÿ¢Ÿæ ⁄©ÿß ÿ®ÿ¨Ÿπ ⁄©€åÿß €Å€íÿü (PKR)', time: '10:32' },
                            { sender: 'customer', text: '150,000-200,000', time: '10:33' },
                            { sender: 'bot', text: '⁄©ŸÑ ⁄©ÿ™ŸÜ€í ÿßŸÅÿ±ÿßÿØ ÿ≥ŸÅÿ± ⁄©ÿ±€å⁄∫ ⁄Ø€íÿü', time: '10:33' },
                            { sender: 'customer', text: '3-4', time: '10:34' },
                            { sender: 'bot', text: 'ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿ™ŸÅÿµ€åŸÑ ÿ®ÿ™ÿßÿ¶€å⁄∫:\nŸÖÿ´ÿßŸÑ: 2 ÿ®ÿßŸÑÿ∫ÿå 1 ÿ®⁄Ü€Å (5 ÿ≥ÿßŸÑ)', time: '10:34' },
                            { sender: 'customer', text: '2 ÿ®ÿßŸÑÿ∫ÿå 2 ÿ®⁄Ü€í', time: '10:35' },
                            { sender: 'bot', text: 'ÿ¢Ÿæ ⁄©ÿ® ÿ≥ŸÅÿ± ⁄©ÿ±ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü (ÿ™ÿßÿ±€åÿÆ €åÿß ŸÖ€Å€åŸÜ€Å)', time: '10:35' },
                            { sender: 'customer', text: 'ŸÖÿßÿ±⁄Ü 2026', time: '10:36' },
                            { sender: 'bot', text: '⁄©ŸàŸÜ ÿ≥ÿß ÿßÿ≥ŸÑÿßŸÖ€å ŸÖ€Å€åŸÜ€Åÿü', time: '10:36' },
                            { sender: 'customer', text: 'Ramadan', time: '10:37' },
                            { sender: 'bot', text: '⁄©ÿ™ŸÜ€í ÿØŸÜ ⁄©ÿß Ÿæ€å⁄©ÿ¨ ⁄Üÿß€Å€å€íÿü', time: '10:37' },
                            { sender: 'customer', text: '14 ÿØŸÜ', time: '10:38' }
                        ]
                    };
                    
                    setConversation(mockData);
                    setLoading(false);
                } catch (err) {
                    setError('⁄à€åŸπÿß ŸÑŸà⁄à ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©ÿß');
                    setLoading(false);
                }
            };

            const updateStatus = async (newStatus) => {
                if (!confirm(`⁄©€åÿß ÿ¢Ÿæ status ⁄©Ÿà "${getStatusLabel(newStatus)}" ŸÖ€å⁄∫ ÿ™ÿ®ÿØ€åŸÑ ⁄©ÿ±ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü`)) {
                    return;
                }

                try {
                    setUpdating(true);
                    
                    // API call to update status
                    // await fetch(`${API_URL}/api/update-status`, {
                    //   method: 'POST',
                    //   headers: { 'Content-Type': 'application/json' },
                    //   body: JSON.stringify({
                    //     lead_id: conversation.lead_id,
                    //     status: newStatus,
                    //     notes: `Status updated via inbox at ${new Date().toLocaleString()}`
                    //   })
                    // });
                    
                    // Mock success
                    setTimeout(() => {
                        setConversation(prev => ({ ...prev, status: newStatus }));
                        setUpdating(false);
                        alert('‚úÖ Status successfully updated!');
                    }, 1000);
                    
                } catch (err) {
                    setUpdating(false);
                    alert('‚ùå Status update failed!');
                }
            };

            const getStatusLabel = (status) => {
                const labels = {
                    'contacted': 'ÿ±ÿßÿ®ÿ∑€Å €ÅŸà ⁄Ø€åÿß',
                    'deal_done': '⁄à€åŸÑ €ÅŸà ⁄Øÿ¶€å',
                    'follow_up': 'ŸÅÿßŸÑŸà ÿßŸæ'
                };
                return labels[status] || status;
            };

            const getStatusColor = (status) => {
                const colors = {
                    'new': 'bg-blue-100 text-blue-800',
                    'assigned': 'bg-purple-100 text-purple-800',
                    'contacted': 'bg-yellow-100 text-yellow-800',
                    'deal_done': 'bg-green-100 text-green-800',
                    'follow_up': 'bg-orange-100 text-orange-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-green-600 mx-auto mb-4"></div>
                            <p className="text-gray-600 text-lg">ŸÑŸà⁄à €ÅŸà ÿ±€Åÿß €Å€í...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center">
                        <div className="bg-white p-8 rounded-2xl shadow-xl text-center">
                            <Icons.AlertCircle className="w-16 h-16 text-red-500 mx-auto mb-4" />
                            <h2 className="text-2xl font-bold text-red-600 mb-2">ÿÆÿ±ÿßÿ®€å</h2>
                            <p className="text-gray-600">{error}</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-100">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg">
                        <div className="max-w-6xl mx-auto px-4 py-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <Icons.MessageCircle />
                                    <div>
                                        <h1 className="text-2xl font-bold">ÿπŸÖÿ±€Å ŸÑ€å⁄à ÿßŸÜÿ®ÿß⁄©ÿ≥</h1>
                                        <p className="text-green-100 text-sm">Lead ID: #{conversation.lead_id}</p>
                                    </div>
                                </div>
                                <div className={`px-4 py-2 rounded-full font-semibold ${getStatusColor(conversation.status)}`}>
                                    {getStatusLabel(conversation.status)}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4 py-6">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            
                            {/* Customer Info Sidebar */}
                            <div className="lg:col-span-1 space-y-6">
                                
                                {/* Customer Details Card */}
                                <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                                    <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4">
                                        <h2 className="text-lg font-bold flex items-center gap-2">
                                            <Icons.Phone />
                                            ⁄©ÿ≥ŸπŸÖÿ± ⁄©€å ÿ™ŸÅÿµ€åŸÑÿßÿ™
                                        </h2>
                                    </div>
                                    <div className="p-6 space-y-4">
                                        <div className="flex items-start gap-3">
                                            <Icons.Phone className="text-gray-400 mt-1" />
                                            <div>
                                                <p className="text-sm text-gray-500">ŸàÿßŸπÿ≥ ÿß€åŸæ ŸÜŸÖÿ®ÿ±</p>
                                                <p className="font-semibold text-gray-900">{conversation.wa_number}</p>
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-start gap-3">
                                            <Icons.Calendar className="text-gray-400 mt-1" />
                                            <div>
                                                <p className="text-sm text-gray-500">ŸÑ€å⁄à ŸàŸÇÿ™</p>
                                                <p className="font-semibold text-gray-900">
                                                    {new Date(conversation.created_at).toLocaleString('ur-PK')}
                                                </p>
                                            </div>
                                        </div>

                                        <div className="flex items-start gap-3">
                                            <Icons.UserCheck className="text-gray-400 mt-1" />
                                            <div>
                                                <p className="text-sm text-gray-500">ÿßÿ≥ÿßÿ¶ŸÜ Ÿπ€åŸÖ</p>
                                                <p className="font-semibold text-gray-900">{conversation.team_name}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Requirements Card */}
                                <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                                    <div className="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4">
                                        <h2 className="text-lg font-bold">ÿ∂ÿ±Ÿàÿ±€åÿßÿ™</h2>
                                    </div>
                                    <div className="p-6 space-y-3 text-sm">
                                        <div className="flex justify-between items-center py-2 border-b">
                                            <span className="text-gray-600">‚úàÔ∏è ÿß€åÿ¶ÿ±ŸæŸàÿ±Ÿπ</span>
                                            <span className="font-semibold">{conversation.answers.departure_airport}</span>
                                        </div>
                                        <div className="flex justify-between items-center py-2 border-b">
                                            <span className="text-gray-600">üí∞ ÿ®ÿ¨Ÿπ</span>
                                            <span className="font-semibold">{conversation.answers.budget_range}</span>
                                        </div>
                                        <div className="flex justify-between items-center py-2 border-b">
                                            <span className="text-gray-600">üë• ÿßŸÅÿ±ÿßÿØ</span>
                                            <span className="font-semibold">{conversation.answers.people_breakdown}</span>
                                        </div>
                                        <div className="flex justify-between items-center py-2 border-b">
                                            <span className="text-gray-600">üìÖ ÿ≥ŸÅÿ±</span>
                                            <span className="font-semibold">{conversation.answers.travel_date}</span>
                                        </div>
                                        <div className="flex justify-between items-center py-2 border-b">
                                            <span className="text-gray-600">üåô ŸÖ€Å€åŸÜ€Å</span>
                                            <span className="font-semibold">{conversation.answers.islamic_month}</span>
                                        </div>
                                        <div className="flex justify-between items-center py-2 border-b">
                                            <span className="text-gray-600">‚è±Ô∏è ÿØŸàÿ±ÿßŸÜ€å€Å</span>
                                            <span className="font-semibold">{conversation.answers.duration_days}</span>
                                        </div>
                                        <div className="flex justify-between items-center py-2">
                                            <span className="text-gray-600">üè® ŸÅÿßÿµŸÑ€Å</span>
                                            <span className="font-semibold">{conversation.answers.hotel_distance_makkah_m}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Action Buttons */}
                                <div className="bg-white rounded-2xl shadow-lg p-6">
                                    <h3 className="font-bold text-gray-800 mb-4">üìä Status Update ⁄©ÿ±€å⁄∫</h3>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => updateStatus('contacted')}
                                            disabled={updating || conversation.status === 'contacted'}
                                            className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 disabled:from-gray-300 disabled:to-gray-400 text-white font-semibold py-3 px-4 rounded-xl transition-all shadow-md hover:shadow-lg disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                        >
                                            <Icons.Phone />
                                            ÿ±ÿßÿ®ÿ∑€Å €ÅŸà ⁄Ø€åÿß
                                        </button>
                                        
                                        <button
                                            onClick={() => updateStatus('deal_done')}
                                            disabled={updating || conversation.status === 'deal_done'}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-300 disabled:to-gray-400 text-white font-semibold py-3 px-4 rounded-xl transition-all shadow-md hover:shadow-lg disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                        >
                                            <Icons.UserCheck />
                                            ⁄à€åŸÑ €ÅŸà ⁄Øÿ¶€å
                                        </button>
                                        
                                        <button
                                            onClick={() => updateStatus('follow_up')}
                                            disabled={updating || conversation.status === 'follow_up'}
                                            className="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 disabled:from-gray-300 disabled:to-gray-400 text-white font-semibold py-3 px-4 rounded-xl transition-all shadow-md hover:shadow-lg disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                        >
                                            <Icons.Calendar />
                                            ŸÅÿßŸÑŸà ÿßŸæ
                                        </button>
                                    </div>
                                    
                                    {updating && (
                                        <div className="mt-4 text-center text-sm text-gray-600">
                                            <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-green-600 mx-auto mb-2"></div>
                                            ÿßŸæ ⁄à€åŸπ €ÅŸà ÿ±€Åÿß €Å€í...
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Chat History */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                                    <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-4">
                                        <h2 className="text-lg font-bold flex items-center gap-2">
                                            <Icons.MessageCircle />
                                            ŸÖ⁄©ŸÖŸÑ ⁄ØŸÅÿ™⁄ØŸà
                                        </h2>
                                        <p className="text-sm text-green-100 mt-1">
                                            üìñ Read-Only Mode - €å€Å ÿµÿ±ŸÅ ÿØ€å⁄©⁄æŸÜ€í ⁄©€í ŸÑ€å€í €Å€í
                                        </p>
                                    </div>
                                    
                                    <div className="p-6 space-y-4 max-h-[600px] overflow-y-auto bg-gray-50">
                                        {conversation.messages.map((msg, idx) => (
                                            <div
                                                key={idx}
                                                className={`flex ${msg.sender === 'customer' ? 'justify-start' : 'justify-end'}`}
                                            >
                                                <div
                                                    className={`max-w-[70%] rounded-2xl px-4 py-3 shadow-md ${
                                                        msg.sender === 'customer'
                                                            ? 'bg-gradient-to-r from-green-500 to-green-600 text-white rounded-br-none'
                                                            : 'bg-white text-gray-800 rounded-bl-none border border-gray-200'
                                                    }`}
                                                >
                                                    <p className="text-sm whitespace-pre-wrap leading-relaxed">{msg.text}</p>
                                                    <p className={`text-xs mt-2 ${msg.sender === 'customer' ? 'text-green-100' : 'text-gray-400'}`}>
                                                        {msg.time}
                                                    </p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="bg-gray-100 p-4 border-t border-gray-200">
                                        <div className="flex items-center justify-center gap-2 text-gray-500 text-sm">
                                            <Icons.AlertCircle />
                                            <span>ÿ¢Ÿæ €å€Åÿß⁄∫ reply ŸÜ€Å€å⁄∫ ⁄©ÿ± ÿ≥⁄©ÿ™€í - ÿµÿ±ŸÅ Status Update ⁄©ÿ±€å⁄∫</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<UmrahInbox />);
    </script>
</body>
</html>
